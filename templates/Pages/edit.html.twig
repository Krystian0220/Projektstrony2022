{% extends 'base.html.twig' %}
{% block body %}

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Infonews</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
          rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
</head>

<body>

<div class="container-fluid p-5 bg-dark text-white text-center">
    <h1>INFONEWS</h1>
    <p>Zmień artykuł</p>
</div>
<div class="container mt-5 h-100">

    <a href="wyloguj.php"><button type="button" class="btn btn-dark">Wyloguj</button></a>
    <a href="{{ path('app_userpage') }}"><button type="button" class="btn btn-dark">Powrót do panelu</button></a>
    <?php
  if (isset($_SESSION["blad"])) echo $_SESSION['blad'];
  ?>
</div>

<div class="container mt-5 h-100">
    <div class="row">
        <div class="col-md-10 text-white ">

            <div class="container mt-5 position-absolute top-50 start-50 translate-middle">
                <h2>Zmiana treści</h2>
                <p>Edytuj treśc</p>
                <?php

     require_once "pol.php";

      try {
        $id=$_GET['id'];


      $dbh = new PDO('mysql:host=localhost;dbname=data_users', 'root' );
      $dbh->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
                $stmt=$dbh->query("SELECT * FROM `news` WHERE `news`.`id_tresci` ='$id'");

                while($row = $stmt->fetch())
                {
                $id=$row['id_tresci'];
                $tresc=$row['tresc'];

                echo '<div class="col-md-10 text-white ">

                    <div class="container mt-5 position-absolute top-50 start-50 translate-middle">
                        <h2>Edytuj treść</h2>
                        <p>Użyj pola aby zmienić treść</p>
                        <form action="add.php" method="post">
                            <div class="mb-4 mt-4">
                                <label for="comment">Comments:</label>
                                <textarea class="form-control" rows="16" id="comment" name="addtresc">'.$tresc.'</textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </form>
                    </div>
                </div>
                ';
                }


                }
                catch (Exception $e) {

                print "Error!: " . $e->getMessage() . "<br/>";
                die();
                }

                if (isset($_POST['submit']))
                {
                try {
                $id=$_GET['id'];
                $zmien_rek=$_POST['edit_rek'];



                $dbh = new PDO('mysql:host=localhost;dbname=data_users', 'root' );
                $dbh->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
                $dbh->query("UPDATE `news` SET `tresc` = '$zmien_rek' WHERE `news`.`id_tresci` = '$id';");
                //foreach($dbh->query('SELECT * from news') as $row) {
                //  print_r($row);
                // echo "\n";}



                $_SESSION['zmien']='<span style="color: green; text-transform:uppercase;">Pomyślnie zmieniono rekord bazy!</span>';
                $_SESSION['zalogowany'] = true;
                header('location:zalogowany.php');

                } catch (Exception $e) {

                print "Error!: " . $e->getMessage() . "<br/>";
                die();
                }


                $dbh = null;


                }



                ?>

            </div>


        </div>


    </div>
</div>
<div class="mt-4 p-3 bg-dark text-white text-center position-absolute bottom-0 start-0 end-0 " >
    <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. </p>





</div>

</body>

{% endblock %}